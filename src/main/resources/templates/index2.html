<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title}">PDF Text Extractor</title>
    <link rel="stylesheet" href="style.css">

</head>
<body>
<div class="container">
    <div class="header">
        <h1>üìÑ PDF Text Extractor</h1>
        <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ PDF —Ñ–∞–π–ª –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞</p>
    </div>

    <div class="content">
        <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö/—É—Å–ø–µ—Ö–µ -->
        <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>
        <div th:if="${success}" class="alert alert-success">
            –¢–µ–∫—Å—Ç —É—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω –∏–∑ —Ñ–∞–π–ª–∞!
        </div>

        <!-- –°–µ–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div th:unless="${success}" class="upload-section" id="uploadSection">
            <form id="uploadForm" th:action="@{/api/pdf/extract/text}" method="post" enctype="multipart/form-data">
                <input type="file" id="pdfFile" name="pdfFile" class="file-input" accept=".pdf" required>
                <button type="button" class="upload-btn" onclick="document.getElementById('pdfFile').click()">
                    üìÅ –í—ã–±–µ—Ä–∏—Ç–µ PDF —Ñ–∞–π–ª
                </button>
                <div class="file-info" id="fileInfo"></div>
                <button type="submit" class="upload-btn" id="submitBtn" style="display: none;">
                    üîç –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç
                </button>
            </form>

            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <p>–û–±—Ä–∞–±–æ—Ç–∫–∞ PDF —Ñ–∞–π–ª–∞...</p>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div th:if="${success}" class="result-section show" id="resultSection">
            <div class="result-header">
                <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è</h2>
                <div class="file-info">
                    –§–∞–π–ª: <strong th:text="${filename}"></strong> |
                    –†–∞–∑–º–µ—Ä: <strong th:text="${#numbers.formatDecimal(fileSize/1024, 1, 2)} + ' KB'"></strong> |
                    –í—Ä–µ–º—è: <strong th:text="${processingTime} + ' ms'"></strong>
                </div>
            </div>

            <div class="result-stats">
                –ò–∑–≤–ª–µ—á–µ–Ω–æ —Å–∏–º–≤–æ–ª–æ–≤: <strong th:text="${#strings.length(text)}"></strong>
            </div>

            <div class="result-text" id="extractedText" th:text="${text}"></div>

            <button class="copy-btn" onclick="copyToClipboard()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç</button>
            <button class="new-extraction" onclick="newExtraction()">üîÑ –ù–æ–≤–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ</button>
        </div>
    </div>
</div>

<script>
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
    document.getElementById('pdfFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const fileInfo = document.getElementById('fileInfo');
        const submitBtn = document.getElementById('submitBtn');

        if (file) {
            fileInfo.innerHTML = `
                    –í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª: <strong>${file.name}</strong><br>
                    –†–∞–∑–º–µ—Ä: <strong>${(file.size/1024).toFixed(2)} KB</strong>
                `;
            submitBtn.style.display = 'inline-block';
        } else {
            fileInfo.innerHTML = '';
            submitBtn.style.display = 'none';
        }
    });

    // Drag and drop —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
    const uploadSection = document.getElementById('uploadSection');

    uploadSection.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadSection.classList.add('dragover');
    });

    uploadSection.addEventListener('dragleave', function(e) {
        e.preventDefault();
        uploadSection.classList.remove('dragover');
    });

    uploadSection.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadSection.classList.remove('dragover');

        const files = e.dataTransfer.files;
        if (files.length > 0) {
            const fileInput = document.getElementById('pdfFile');
            fileInput.files = files;

            // –¢—Ä–∏–≥–≥–µ—Ä–∏–º —Å–æ–±—ã—Ç–∏–µ change
            const event = new Event('change', { bubbles: true });
            fileInput.dispatchEvent(event);
        }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
    document.getElementById('uploadForm').addEventListener('submit', function(e) {
        document.getElementById('loading').style.display = 'block';
        document.getElementById('submitBtn').style.display = 'none';
    });

    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
    function copyToClipboard() {
        const text = document.getElementById('extractedText').textContent;
        navigator.clipboard.writeText(text).then(function() {
            alert('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
        }, function(err) {
            console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
        });
    }

    // –ù–æ–≤–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ
    function newExtraction() {
        window.location.href = '/';
    }

    // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ —Ñ–∞–π–ª–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', function() {
        const fileInput = document.getElementById('pdfFile');
        if (fileInput && !fileInput.files.length) {
            fileInput.value = '';
        }
    });
</script>
</body>
</html>